---
import WorkshopLayout from "../layouts/WorkshopLayout.astro";
import ContributorWall from "../components/ContributorWall.astro";
import SystemMessage from "../components/SystemMessage.astro";
import ModulePageWithTasks from "../components/ModulePageWithTasks.astro";
import CursorPrompts from "../components/CursorPrompts.astro";
import CollapsibleSection from "../components/CollapsibleSection.astro";
import ModuleGoalPanel from "../components/ModuleGoalPanel.astro";
import content from "../content/steps/05-contribution.ts";
---

<WorkshopLayout title="Contribution" description="Make a real contribution. Completion unlocks Contributor.">
  <article class="module-page contribution-module">
    <header class="module-header">
      <h1>Contribution</h1>
      <dl class="module-meta" aria-label="Module info">
        <dt>Module</dt>
        <dd>CONTRIBUTION</dd>
        <dt>Access Requirement</dt>
        <dd>Operator</dd>
        <dt>Completion Unlocks</dt>
        <dd>Contributor</dd>
      </dl>
    </header>

    <ModuleGoalPanel goal={content.goal} estimatedTime={content.estimatedTime} />

    <ModulePageWithTasks moduleId="contribution" tasks={content.tasks} taskSectionIds={content.taskSectionIds}>
      <p class="step-intent" aria-label="Status">
        <em>Contributor permissions available.</em>
      </p>

      <SystemMessage message={content.systemMessage} typed={true} />

      <section class="step-card" aria-labelledby="modifying-the-system">
      <h2 id="modifying-the-system">Modifying the System</h2>
      <p>This module guides you through making a real contribution.</p>
      <p>Not a simulation.</p>
      <p>Not a practice run.</p>
      <p>A real change, proposed through the same workflow used by teams every day.</p>
      <p>This is how work moves forward.</p>
      </section>

      <CollapsibleSection id="what-contribution-is" title="What a Contribution Is" stepCard={true}>
      <h2 id="what-contribution-is">What a Contribution Is</h2>
      <p>A contribution is a proposed change to a shared system.</p>
      <p>It usually involves:</p>
      <ul>
        <li>Making a small update</li>
        <li>Recording what changed</li>
        <li>Submitting it for review</li>
      </ul>
      <p>The review process exists to protect the system, not to judge you.</p>
    </CollapsibleSection>

      <CollapsibleSection id="what-youll-do" title="What You'll Do" stepCard={true}>
      <h2 id="what-youll-do">What You’ll Do</h2>
      <p>In this module, you will:</p>
      <ol>
        <li>Create a new branch</li>
        <li>Make a small, safe change</li>
        <li>Commit your change</li>
        <li>Submit a pull request</li>
      </ol>
      <p>Once your pull request is open, your contribution is complete.</p>
      <p>It does not need to be merged immediately.</p>
    </CollapsibleSection>

      <CollapsibleSection id="step-1-branch" title="Step 1: Create a Branch" stepCard={true} taskIndex={0} moduleId="contribution">
      <h2 id="step-1-branch">Step 1: Create a Branch</h2>
      <p>Branches give you a safe place to work.</p>
      <p>In Cursor:</p>
      <ol>
        <li>Open the Command Palette</li>
        <li>Search for <strong>Git: Create Branch</strong></li>
        <li>Name your branch something descriptive<br /><span class="text-muted">(For example: <code>add-elizabeth-davis</code>)</span></li>
      </ol>
      <p>Your changes will live here until they’re reviewed.</p>
    </CollapsibleSection>

      <CollapsibleSection id="step-2-change" title="Step 2: Make a Small Change" stepCard={true} taskIndex={1} moduleId="contribution">
      <h2 id="step-2-change">Step 2: Make a Small Change</h2>
      <p>Choose one of the following options.</p>

      <h3>Option A: Add Yourself as a Contributor</h3>
      <ul>
        <li>Locate the contributors file in the project</li>
        <li>Add your name and any required information</li>
        <li>Follow the existing format exactly</li>
      </ul>

      <ContributorWall />

      <p class="text-muted">The wall above is built from a data file. Add your entry there and you’ll show up once your PR is merged.</p>

      <h3>Option B: Make a Minor UI Change</h3>
      <ul>
        <li>Update a short piece of text</li>
        <li>Adjust a small visual detail</li>
        <li>Make a change that is easy to review</li>
      </ul>

      <p>If you’re unsure what to change, ask Cursor:</p>
      <blockquote>“What is a safe, beginner-friendly change I can make in this project?”</blockquote>
    </CollapsibleSection>

      <CollapsibleSection id="step-3-commit" title="Step 3: Commit Your Change" stepCard={true} taskIndex={2} moduleId="contribution">
      <h2 id="step-3-commit">Step 3: Commit Your Change</h2>
      <p>Once your change is ready:</p>
      <ol>
        <li>Open the Source Control panel in Cursor</li>
        <li>Review the changed files</li>
        <li>Write a short commit message describing what you did<br /><span class="text-muted">(For example: “Add contributor entry”)</span></li>
        <li>Commit the change</li>
      </ol>
      <p>This records your work.</p>
    </CollapsibleSection>

      <CollapsibleSection id="step-4-pr" title="Step 4: Submit a Pull Request" stepCard={true} taskIndex={3} moduleId="contribution">
      <h2 id="step-4-pr">Step 4: Submit a Pull Request</h2>
      <p>Now it’s time to propose your change.</p>
      <ol>
        <li>Push your branch to GitHub when prompted</li>
        <li>Open the pull request link</li>
        <li>Review the summary</li>
        <li>Submit the pull request</li>
      </ol>
      <p>That’s it.</p>
    </CollapsibleSection>

      <CollapsibleSection id="what-happens-next" title="What Happens Next" stepCard={true}>
      <h2 id="what-happens-next">What Happens Next</h2>
      <p>Your pull request may receive:</p>
      <ul>
        <li>Comments</li>
        <li>Suggestions</li>
        <li>Approval</li>
      </ul>
      <p>This is normal.</p>
      <p>Feedback is part of collaboration, not correction.</p>
    </CollapsibleSection>

      <CollapsibleSection id="if-unclear" title="If Something Feels Unclear" stepCard={true}>
      <h2 id="if-unclear">If Something Feels Unclear</h2>
      <p>That’s expected.</p>
      <p>You can:</p>
      <ul>
        <li>Ask Cursor to explain what you’re seeing</li>
        <li>Ask Cursor what to do next</li>
        <li>Ask Cursor how to fix a problem</li>
      </ul>
      <p>Use the tools you’ve already practiced with.</p>
    </CollapsibleSection>

    <CollapsibleSection id="complete-module" title="Complete This Module" stepCard={true}>
      <h2 id="complete-module">Complete This Module</h2>
      <p>Once your pull request is open, you’ve completed the program’s core workflow.</p>
      <p>Regardless of outcome, you’ve participated correctly.</p>
    </CollapsibleSection>

      <CursorPrompts prompts={content.cursorPrompts} />

      <section id="contribution-mark-complete" class="welcome-mark-complete module-mark-complete" aria-label="Mark module complete">
      <p id="contribution-mark-complete-confirm" class="system-message welcome-mark-complete-msg" role="status" aria-live="polite" hidden>
        Contribution recorded. Access level upgraded: Contributor.
      </p>
      <div id="contribution-mark-complete-actions">
        <button type="button" id="contribution-mark-complete-btn" class="workshop-btn workshop-btn--primary">
          Confirm contribution submitted
        </button>
      </div>
      </section>

      <p class="module-next-hint">
        <em>On confirmation:</em> Contribution recorded. Access level upgraded: Contributor.
      </p>
    </ModulePageWithTasks>
  </article>
</WorkshopLayout>

<script>
  import { markModuleComplete, isModuleComplete } from "../lib/progress";

  const btn = document.getElementById("contribution-mark-complete-btn");
  const confirmEl = document.getElementById("contribution-mark-complete-confirm");

  function showConfirmation() {
    if (confirmEl) {
      confirmEl.hidden = false;
      confirmEl.setAttribute("aria-live", "polite");
    }
    if (btn) btn.hidden = true;
  }

  if (isModuleComplete("contribution")) {
    showConfirmation();
  } else if (btn) {
    btn.addEventListener("click", () => {
      markModuleComplete("contribution");
      document.dispatchEvent(new CustomEvent("workshop-progress-update"));
      const base = typeof import.meta.env !== "undefined" && import.meta.env.BASE_URL ? import.meta.env.BASE_URL : "/cursor-workshop/";
      window.location.replace(base);
    });
  }
</script>
