---
import MatrixModuleLayout from "../layouts/MatrixModuleLayout.astro";
import ContributorWall from "../components/ContributorWall.astro";
import ModulePageWithTasks from "../components/ModulePageWithTasks.astro";
import CursorPrompts from "../components/CursorPrompts.astro";
import CollapsibleSection from "../components/CollapsibleSection.astro";
import ModuleGoalPanel from "../components/ModuleGoalPanel.astro";
import content from "../content/steps/05-contribution";
---

<MatrixModuleLayout title="Contribution" description="Make a real contribution. Completion unlocks Contributor.">
  <article class="module-page contribution-module">
    <header class="module-header">
      <h1>Contribution</h1>
    </header>

    <ModuleGoalPanel goal={content.goal} estimatedTime={content.estimatedTime} />

    <ModulePageWithTasks moduleId="contribution" tasks={content.tasks} taskSectionIds={content.taskSectionIds}>
      <div slot="sidebar-complete" class="module-sidebar-complete">
        <p id="contribution-completed" class="module-completed" role="status" aria-live="polite" hidden>Completed</p>
        <div id="contribution-mark-complete-actions">
          <button type="button" id="contribution-mark-complete-btn" class="module-btn">
            <div class="module-btn__fill" aria-hidden="true"></div>
            <span class="module-btn__text">Confirm contribution submitted</span>
          </button>
        </div>
      </div>
      <div class="content-stack">
      <section class="step-card" aria-labelledby="modifying-the-system">
      <h2 id="modifying-the-system">Modifying the System</h2>
      <p>This module is a real contribution using the same workflow teams use every day.
        Your changes are safe: they won’t affect anyone else until your pull request is reviewed and merged.</p>
      </section>

      <CollapsibleSection id="what-contribution-is" title="What is a Contribution?" stepCard={true}>
      <p>A contribution is a proposed change to a shared system.</p>
      <p>It usually involves:</p>
      <ul>
        <li>Making an update</li>
        <li>Recording what changed</li>
        <li>Submitting it for review</li>
      </ul>
      <p>The review process exists to protect the system, not to judge you.</p>
    </CollapsibleSection>

      <CollapsibleSection id="what-youll-do" title="What You'll Do" stepCard={true}>
      <h2 id="what-youll-do">What You’ll Do</h2>
      <p>In this module, you will:</p>
      <ul>
        <li>Create a new branch (your own safe workspace).</li>
        <li>Add yourself to the Agents page by adding a standardized ID badge entry.</li>
        <li>Commit your change with a short message describing what you did.</li>
        <li>Push your branch and open a pull request on GitHub.</li>
      </ul>
      <p>Once your pull request is open, your contribution is complete.</p>
      <p>It does not need to be merged immediately.</p>
    </CollapsibleSection>

      <CollapsibleSection id="step-1-branch" title="Step 1: Create a Branch" stepCard={true} taskIndex={0} moduleId="contribution">
      <p>A branch is your personal copy of the project changes. You’ll work here so the main branch stays protected.</p>

      <ul>
        <li>Watch this short video to see how to create a new branch: <a href="https://www.youtube.com/watch?v=MM-ckM4_Hxs" target="_blank">https://www.youtube.com/watch?v=MM-ckM4_Hxs</a></li>
        <li>Create a new branch called <code>add-yourname</code></li>
      </ul>

      <p>Note: It's good practice to keep branch names lowercase, short, and use dashes instead of spaces. </p>
      <p>Your changes will live here until they’re reviewed.</p>
    </CollapsibleSection>

      <CollapsibleSection id="step-2-change" title="Step 2: Add Yourself to the Agents Page" stepCard={true} taskIndex={1} moduleId="contribution">
      <p>You’ll add a standardized ID badge entry (name, team, avatar, and WEX start date).
        The Agents page is generated from a data file—your job is to add one entry.</p>

        <p> Ask Cursor AI Chat to edit the file <code>src/data/contributors.json</code>. Provide it with the following details: </p>
      <ul>
        <li><strong>name</strong> — your full name</li>
        <li><strong>team</strong> — your team name</li>
        <li><strong>role</strong> — your role at WEX</li>
        <li><strong>startDate</strong> — your start date at WEX, month and year</li>
        <li><strong>avatarUrl</strong> — path to your avatar image (manually add the image to the public/avatars folder)</li>
      </ul>

      <p>Here is a full prompt example: </p>
      <blockquote>
        "Add me to the contributors board. Use the project rules for the exact file and format (name, team, role, startDate, avatarUrl).
        My name is Rocket Davis, I'm a UX Designer Cat on the The Bosses team, and I started at WEX in December 2023.
        My avatar image is in the public/avatars folder as rocket-davis.jpg.
        Add my entry to the contributors.json file."
      </blockquote>

    </CollapsibleSection>

    <CollapsibleSection id="step-3-confirm" title="Step 3: Confirm Your Change" stepCard={true} taskIndex={2} moduleId="contribution">
      <p>Once your change is ready:</p>
      <ul>
        <li>Save the file.</li>
        <li>Check your running app in the browser.</li>
        <li>Go to the Agents page.</li>
        <li>Confirm your badge appears with the correct name, team, avatar, and start date.</li>
        <li>If everything looks good, you can proceed keep the changes Cursor made to the file and move on to the next step.</li>
      </ul>

      <p>If your badge doesn’t show up:</p>
    <ul>
      <li>Refresh the browser.</li>
      <li>Double-check your entry matches the file format exactly.</li>
      <li>Ask Cursor (using ASK mode): “Why isn’t my new agent entry appearing on the Agents page?”</li>
    </ul>
    </CollapsibleSection>

      <CollapsibleSection id="step-4-commit" title="Step 4: Commit Your Change" stepCard={true} taskIndex={2} moduleId="contribution">
      <p>A commit is a saved snapshot of your work, with a short message describing what changed.</p>
      <p>Once your change is ready:</p>
      <ul>
        <li>Ask Cursor (using ASK mode): “What changes did you make to the contributors.json file?”</li>
        <li>Review the changes.</li>
        <li>Write a short commit message describing what you did (For example: “Add contributor entry”)</li>
        <li>Using AGENT mode, ask Cursor to commit and push the changes to your branch</li>
      </ul>
    </CollapsibleSection>

      <CollapsibleSection id="step-5-pr" title="Step 5: Submit a Pull Request" stepCard={true} taskIndex={3} moduleId="contribution">
      <p>Now it’s time to propose your change.</p>
      <ul>
        <li>After you push your changes, your branch will appear in the list of branches in the repository in GitHub</li>
        <li>Click on your branch to open it</li>
        <li>Click the "Create pull request" button</li>
        <li>Add Elizabeth Davis or Fernanda Helenco as reviewers</li>
        <li>Add a title and description for your pull request</li>
        <li>Click the "Create pull request" button</li>
      </ul>
      <p>That’s it! Your pull request is now open.</p>
    </CollapsibleSection>

      <CollapsibleSection id="what-happens-next" title="What Happens Next" stepCard={true}>
      <p>Your pull request may receive:</p>
      <ul>
        <li>Comments</li>
        <li>Suggestions</li>
        <li>Approval</li>
      </ul>
      <p>This is normal.</p>
      <p>Feedback is part of collaboration, not correction.</p>
      <p>After your pull request is reviewed and merged, you’ve completed the program’s core workflow. Your changes will now be live on the Agents page.</p>
    </CollapsibleSection>

      <CollapsibleSection id="troubleshooting" title="Troubleshooting" stepCard={true}>
      <p>If something goes wrong, that’s the name of the game when it comes to code and AI.</p>
      <p>You can:</p>
      <ul>
        <li>Ask Cursor to explain what you’re seeing</li>
        <li>Ask Cursor what to do next</li>
        <li>Ask Cursor how to fix a problem</li>
        <li>Remember to use different modes of Cursor (ASK, AGENT, PLAN) to help you troubleshoot</li>
      </ul>
      <p>Use the tools you’ve already practiced with.</p>
    </CollapsibleSection>

      </div>

      <CursorPrompts prompts={content.cursorPrompts} />
    </ModulePageWithTasks>
  </article>
</MatrixModuleLayout>

<script>
  import { markModuleComplete, isModuleComplete, clearModuleComplete } from "../lib/progress";

  const baseUrl = import.meta.env.BASE_URL || "/";
  const MODULE_ID = "contribution";
  const btn = document.getElementById("contribution-mark-complete-btn");
  const completedEl = document.getElementById("contribution-completed");

  function showConfirmation() {
    if (completedEl) completedEl.hidden = false;
    if (btn) btn.hidden = true;
  }

  function showButtonAgain() {
    if (completedEl) completedEl.hidden = true;
    if (btn) btn.hidden = false;
  }

  if (isModuleComplete(MODULE_ID)) {
    showConfirmation();
  }
  if (btn) {
    btn.addEventListener("click", () => {
      markModuleComplete(MODULE_ID);
      document.dispatchEvent(new CustomEvent("workshop-progress-update"));
      window.location.href = baseUrl;
    });
  }

  document.addEventListener("workshop-tasks-reset", (e) => {
    const detail = (e as CustomEvent).detail;
    if (detail?.moduleId === MODULE_ID) {
      clearModuleComplete(MODULE_ID);
      document.dispatchEvent(new CustomEvent("workshop-progress-update"));
      showButtonAgain();
    }
  });
</script>
