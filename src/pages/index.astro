---
import MatrixProtocolLayout from "../layouts/MatrixProtocolLayout.astro";
import MatrixRain from "../components/MatrixRain.astro";
import Scanlines from "../components/Scanlines.astro";
import TerminalBlock from "../components/TerminalBlock.astro";
import MatrixModulesSection from "../components/MatrixModulesSection.astro";
---

<MatrixProtocolLayout title="Cursor Workshop | Matrix Protocol">
  <MatrixRain />
  <Scanlines />
  <div class="relative z-10 w-full min-h-screen flex flex-col">
    <main class="flex-grow flex flex-col items-center justify-center py-12 px-4">
      <TerminalBlock />
    </main>
    <div id="matrix-modules" class="hidden" aria-hidden="true">
      <MatrixModulesSection />
    </div>
  </div>
</MatrixProtocolLayout>

<script>
  const ACCESS_KEY = "cursor-workshop-matrix-access";

  function showModulesIfGranted() {
    if (typeof sessionStorage === "undefined") return;
    if (sessionStorage.getItem(ACCESS_KEY) === "true") {
      const el = document.getElementById("matrix-modules");
      if (el) {
        el.classList.remove("hidden");
        el.setAttribute("aria-hidden", "false");
      }
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", showModulesIfGranted);
  } else {
    showModulesIfGranted();
  }
</script>
