---
import MatrixModuleLayout from "../layouts/MatrixModuleLayout.astro";
import CopyButton from "../components/CopyButton.astro";
import ModulePageWithTasks from "../components/ModulePageWithTasks.astro";
import CollapsibleSection from "../components/CollapsibleSection.astro";
import ModuleGoalPanel from "../components/ModuleGoalPanel.astro";
import content from "../content/steps/03-clone-and-run";

const REPO_URL = "https://github.com/elizabethwex/cursor-workshop";
const REPO_CLONE_URL = "https://github.com/elizabethwex/cursor-workshop.git";
---

<MatrixModuleLayout title="Localhost: Clone and run" description="Run this project locally. Completion unlocks Operator.">
  <article class="module-page localhost-module">
    <header class="module-header">
      <h1>Localhost: Clone and run locally</h1>
    </header>

    <ModuleGoalPanel goal={content.goal} estimatedTime={content.estimatedTime} />

    <ModulePageWithTasks moduleId="clone-and-run" tasks={content.tasks} taskSectionIds={content.taskSectionIds}>
      <div slot="sidebar-complete" class="module-sidebar-complete">
        <p id="localhost-completed" class="module-completed" role="status" aria-live="polite" hidden>Completed</p>
        <div id="localhost-mark-complete-actions">
          <button type="button" id="localhost-mark-complete-btn" class="module-btn">
            <div class="module-btn__fill" aria-hidden="true"></div>
            <span class="module-btn__text">Confirm local environment is running</span>
          </button>
        </div>
      </div>

      <div class="content-stack">
      <section class="step-card" aria-labelledby="running-locally">
      <h2 id="running-locally">Running the System Locally</h2>
      <p>Now that you have access to GitHub and Cursor, you’re ready to bring a real project onto your computer and run it locally. This is where things start to feel real.</p>
      <p>This is called <strong>localhost</strong>.</p>
      <p>It means:</p>
      <ul>
        <li>The app is running on your computer</li>
        <li>You control the environment</li>
        <li>Nothing is shared publicly</li>
      </ul>
      <p>This step can feel intimidating, but it is also the most important one.</p>
      <p>Take it slowly.</p>
      </section>

      <CollapsibleSection id="high-level" title="What You're Doing (At a High Level)" stepCard={true}>
      <p>Right now, the code for this project lives on GitHub:</p>
      <p>
        <a href={REPO_URL} target="_blank" rel="noopener noreferrer">{REPO_URL}</a>
      </p></br>
      <p>GitHub is where the code is stored.</p>
      <p>Cursor is the tool that helps you work with it.</p>
      <p>In this module, you will:</p>
      <ul>
        <li>Copy the code from GitHub to your machine</li>
        <li>Open it in Cursor so you can see and edit it</li>
        <li>Run it locally to see the UI in your browser</li>
      </ul>
      <p>When you clone a repository you are creating a full copy of the project — including its version history — on your computer.</p></br>
      <p>This gives you a safe space to explore and experiment.</p>
    </CollapsibleSection>

      <CollapsibleSection id="step-1-clone" title="Step 1: Clone the Repository in Cursor" stepCard={true} taskIndex={0} moduleId="clone-and-run">
      <p>Cloning creates a local copy of the project on your computer.</p>
      <p>You will do this <strong>inside Cursor</strong>, not in a separate terminal.</p>

      <p>Before opening Cursor, create a new folder called <code>Cursor</code> in your Finder. We recommend putting it in your <code>Documents</code> folder. Inside that Cursor folder, create a new folder for this project. You can call it <code>cursor-workshop</code>. This is just a organization preference, find something that works for you!</p></br>


      <h3>Now let's go back to Cursor:</h3>
      <ul>
        <li>Open the Cursor app</li>
        <li>From the options on the homescreen click <code>Clone repo</code></span></li>
        <li>paste in the url <code>https://github.com/elizabethwex/cursor-workshop.git</code> and press enter</li>
        <li>Select the <code>cursor-workshop</code> folder you just made.</li>
      </ul>
      <p>Cursor will now download the code from GitHub to your machine.</p>

      <p>At this point:</p>
      <ul>
        <li>The code is now on your machine</li>
        <li>Cursor is showing you the project files</li>
        <li>You are looking at the same code that lives on GitHub</li>
      </ul>
      <p>You haven’t changed anything yet.</p>
    </CollapsibleSection>

    <CollapsibleSection id="step-2-install" title="Step 2: Run the Project" stepCard={true}>
      <p>A note on terminal commands: The terminal is a text-based way to give instructions to your computer. There is an app called Terminal on your computer, and there is also one in Cursor. You’ll use Cursor’s integrated terminal for this workshop. You are not modifying your system — you are running project-specific commands. You can also run these in the AI chat window.</p></br>
      
      <p>Projects rely on external packages to work, these are called dependencies.</p>
      <p>These are listed in a file called <code>package.json</code>.</p>
      <p>When you run <code>npm install</code>, your computer downloads those dependencies into a folder called <code>node_modules</code>. You only need to install dependencies once per project (unless they change later).</p>
      </br>
      <p>Alternatively, you can just ask Cursor to <code>run the project cursor-workshop</code> and it should do all of this for you.</p></br>
      <p>This may take a minute. Cursor might ask your permission to run commands. You can safely keep clicking 'Run'.</p>
      <p>You may see warnings. Warnings are normal.</p>
      <p>If an error appears, pause and read it. Cursor can help you understand what it means.</p>
      </br>
      <p>If successful, the terminal will display a local URL.</p>
      <p>It usually looks like: <code>http://localhost:5173</code>. The number is called a port. It's just a temporary channel your computer uses to run the app. The exact number may vary.</p>
    </CollapsibleSection>

      <CollapsibleSection id="step-4-open" title="Step 3: Open Localhost Browser" stepCard={true} taskIndex={3} moduleId="clone-and-run">
      <p>Open the URL shown in the terminal in your preferred browser.</p>
      <p>You can also open a brower window directly in Cursor to run the localhost.</p>
      <p>If you see the app running, the system is online!</p>
      <p>You should now be seeing the UI rendered from code on your machine. Changes you make to code will now appear here.</p>
    </CollapsibleSection>

      <CollapsibleSection id="troubleshooting" title="If Something Doesn't Work" stepCard={true}>
      <h2 id="troubleshooting">If Something Doesn’t Work</h2>
      <p>This is normal.</p>
      <p>Most people encounter at least one issue the first time they run a project locally.</p>
      <p>Common causes include:</p>
      <ul>
        <li>Missing Node.js</li>
        <li>A command typed incorrectly</li>
        <li>A dependency failing to install</li>
      </ul>
      <p>You are not expected to diagnose this alone.</p></br>

      <h3><strong>Use Cursor to Debug</strong></h3>
      <p>Cursor is especially useful here.</p>
      <p>You can ask it things like:</p>
      <ul>
        <li>“Why did this command fail?”</li>
        <li>“What does this error message mean?”</li>
        <li>“What should I try next?”</li>
      </ul>
      <p>Paste the error directly into Cursor chat.</p>
      <p>That’s what it’s for.</p>
    </CollapsibleSection>

      <CollapsibleSection id="confirmation" title="Confirmation" stepCard={true}>
      <p>If you can see this app running from localhost, you’ve completed this module.</p>
      <p>This is the hardest step for many designers.</p>
      <p>If you’re here, you’re doing well!</p>
    </CollapsibleSection>

      <CollapsibleSection id="system-notes" title="System Notes" stepCard={true}>
      <ul>
        <li>You can stop the local server at any time by pressing <kbd>Ctrl</kbd> + <kbd>C</kbd> in the terminal</li>
        <li>You can restart it whenever you need</li>
        <li>Running a project locally does not change GitHub.</li>
        <li>Your changes stay on your machine until you commit and push them intentionally.</li>
        <li>Running locally is a foundational skill—everything else builds on this</li>
      </ul>
    </CollapsibleSection>

      </div>
    </ModulePageWithTasks>
  </article>
</MatrixModuleLayout>

<script>
  import { markModuleComplete, isModuleComplete, clearModuleComplete } from "../lib/progress";

  const baseUrl = import.meta.env.BASE_URL || "/";
  const MODULE_ID = "clone-and-run";
  const btn = document.getElementById("localhost-mark-complete-btn");
  const completedEl = document.getElementById("localhost-completed");

  function showConfirmation() {
    if (completedEl) completedEl.hidden = false;
    if (btn) btn.hidden = true;
  }

  function showButtonAgain() {
    if (completedEl) completedEl.hidden = true;
    if (btn) btn.hidden = false;
  }

  if (isModuleComplete(MODULE_ID)) {
    showConfirmation();
  }
  if (btn) {
    btn.addEventListener("click", () => {
      markModuleComplete(MODULE_ID);
      document.dispatchEvent(new CustomEvent("workshop-progress-update"));
      window.location.href = baseUrl;
    });
  }

  document.addEventListener("workshop-tasks-reset", (e) => {
    const detail = (e as CustomEvent).detail;
    if (detail?.moduleId === MODULE_ID) {
      clearModuleComplete(MODULE_ID);
      document.dispatchEvent(new CustomEvent("workshop-progress-update"));
      showButtonAgain();
    }
  });
</script>
