---
import MatrixModuleLayout from "../layouts/MatrixModuleLayout.astro";
import SystemMessage from "../components/SystemMessage.astro";
import ModulePageWithTasks from "../components/ModulePageWithTasks.astro";
import CollapsibleSection from "../components/CollapsibleSection.astro";
import ModuleGoalPanel from "../components/ModuleGoalPanel.astro";
import content from "../content/steps/02-github-basics.ts";
---

<MatrixModuleLayout title="GitHub basics" description="Get access to GitHub and learn the basics. Completion unlocks LOCALHOST.">
  <article class="module-page github-module">
    <header class="module-header">
      <h1>GitHub Basics</h1>
    </header>

    <ModuleGoalPanel goal={content.goal} estimatedTime={content.estimatedTime} mission={content.intent} />

    <ModulePageWithTasks moduleId="github-basics" tasks={content.tasks} taskSectionIds={content.taskSectionIds}>
      <div slot="sidebar-complete" class="module-sidebar-complete">
        <p id="github-completed" class="module-completed" role="status" aria-live="polite" hidden>Completed</p>
        <div id="github-mark-complete-actions">
          <button type="button" id="github-mark-complete-btn" class="module-btn">
            <div class="module-btn__fill" aria-hidden="true"></div>
            <span class="module-btn__text">Mark GitHub basics complete</span>
          </button>
        </div>
      </div>
      <SystemMessage message={content.systemMessage} typed={true} systemCheck={true} />

      <div class="content-stack">
      <section class="step-card" aria-labelledby="shared-workspaces">
        <h2 id="shared-workspaces">GitHub: Shared Workspaces</h2>
        <p>GitHub is where teams store, review, and collaborate on code.</p>
        <p>For designers, it helps to think of GitHub as:</p>
        <ul>
          <li>A shared project folder</li>
          <li>With a complete history of changes</li>
          <li>And a structured way to propose updates safely</li>
        </ul>
        <p>You do not need to memorize commands.</p>
        <p>You do need to understand how changes move through the system.</p>
      </section>

      <CollapsibleSection id="getting-access" title="Getting Access at WEX" stepCard={true} taskIndex={0} moduleId="github-basics">
      <h2 id="getting-access">Getting Access at WEX</h2>
      <p>GitHub access at WEX is managed through enterprise accounts and teams.</p>

      <h3>Step 1: Request Access to the GitHub EMU</h3>
      <p>To get started, submit a ticket to request access to the GitHub Enterprise Managed User (EMU):</p>
      <p>
        <a href="https://wexinc.atlassian.net/servicedesk/customer/portal/1016/create/1195" target="_blank" rel="noopener noreferrer">
          wexinc.atlassian.net/servicedesk/customer/portal/1016/create/1195
        </a>
      </p>
      <p>When submitting the ticket:</p>
      <ul>
        <li>Select <strong>“Add a new user”</strong></li>
        <li>Follow the instructions provided in the form</li>
      </ul>
      <p>Once approved, you’ll be able to sign in to GitHub using your WEX-managed account.</p>

      <h3>Step 2: Team Setup (Design Teams)</h3>
      <p>GitHub access is organized by teams.</p>
      <p>For design teams:</p>
      <ul>
        <li>A new <strong>enterprise team</strong> must be created</li>
        <li>Additional tickets are required to add members to each team</li>
      </ul>
      <p>This ensures:</p>
      <ul>
        <li>Correct access to repositories</li>
        <li>Clear ownership</li>
        <li>Safer collaboration across groups</li>
      </ul>
      <p>If you’re unsure which team you should belong to, check with your design lead.</p>
    </CollapsibleSection>

      <CollapsibleSection id="core-concepts" title="Core Concepts" stepCard={true} taskIndex={1} moduleId="github-basics">
      <p>These concepts will come up often. Understanding them now will make everything else easier.</p>

      <h3>Repository</h3>
      <p>A repository is the project itself.</p>
      <p>It contains:</p>
      <ul>
        <li>All files and folders</li>
        <li>A full history of changes</li>
        <li>Configuration for things like deployment and permissions</li>
      </ul></br>
      <p>A repository exists in two places:</p>
      <ul>
        <li>On GitHub (remote)</li>
        <li>On your computer (local copy)</li>
      </ul></br>
      <p>You will clone the remote repository to create your local copy. From there, you can make changes safely before sharing them.</p>
      </br>

      <h3>Main Branch</h3>
      <p>The <strong>main</strong> branch is the primary, trusted version of the project.</p>
      <p>Think of it as:</p>
      <ul>
        <li>The current source of truth</li>
        <li>The version others build from</li>
        <li>The branch protected from direct changes</li>
      </ul>
      <p>You generally do <strong>not</strong> edit <code>main</code> directly.</p>
      <p>Instead, changes are made in branches and merged back through pull requests.</p>
      </br>

      <h3>Branch</h3>
      <p>A branch is a safe workspace.</p>
      <p>Branches let you:</p>
      <ul>
        <li>Make changes without affecting the main branch</li>
        <li>Experiment freely</li>
        <li>Propose updates for review</li>
      </ul>
      <p>Branches are temporary by design.</p>
      </br>

      <h3>Commit</h3>
      <p>A commit saves changes inside your branch. It records what changed and includes a short message explaining why.</p>
      <p>Each commit:</p>
      <ul>
        <li>Captures what changed at that moment</li>
        <li>Includes a short message explaining why</li>
      </ul>
      <p>Small, clear commits are encouraged.</p>
      </br>

      <h3>Pull Request</h3>
      <p>A pull request proposes merging your branch into the main branch. It is a request for review — not an automatic change. Opening a pull request does not make your change live. It starts a conversation.</p>
      <p>PRs are how teams:</p>
      <ul>
        <li>Review work</li>
        <li>Discuss decisions</li>
        <li>Approve updates</li>
      </ul>
      <p>Opening a PR does not mean your change is final.</p>
      <p>It means it’s ready for review.</p>
    </CollapsibleSection>

      <CollapsibleSection id="github-pages" title="GitHub Pages (Why This App Has a Public URL)" stepCard={true}>
      <h2 id="github-pages">GitHub Pages (Why This App Has a Public URL)</h2>
      <p>GitHub can host static sites using <strong>GitHub Pages</strong>.</p>
      <p>This allows a repository to:</p>
      <ul>
        <li>Publish a site automatically</li>
        <li>Provide a public URL</li>
        <li>Share documentation, demos, or tools</li>
      </ul>
      <p>This workshop app is hosted using GitHub Pages.</p>
      <p>Later, you’ll run the same app locally on your machine.</p>
    </CollapsibleSection>

      <CollapsibleSection id="ssh" title="Connecting Cursor to GitHub (SSH vs HTTPS)" stepCard={true} taskIndex={2} moduleId="github-basics">
      <p>To work smoothly with GitHub, Cursor needs a secure way to authenticate.</p>
      <p>This is done using an <strong>SSH key</strong> or via <strong>HTTPS connection</strong>.</p>

      <h3>SSH Keys</h3>
      <p>An SSH key is a secure identifier stored on your machine.</p>
      <p>It allows Cursor to:</p>
      <ul>
        <li>Connect to GitHub without repeated passwords</li>
        <li>Push and pull changes safely</li>
        <li>Identify you as an authorized user</li>
      </ul>

      <h3>Setting Up an SSH Key in Cursor</h3>
      <ul>
        <li>Open Cursor</li>
        <li>Ask cursor to help you set up an SSH key</li>
        <li>Follow the prompts to generate a new key</li>
        <li>Add the generated public key to your GitHub account (in the settings)</li>
      </ul>

      <h3>Checking That It Works</h3>
      <p>To confirm your SSH connection, ask Cursor to test the SSH connection</p>
      <p>If the connection works, no further action is needed.</p>

      <h3>Why This Matters</h3>
      <p>Without SSH configured:</p>
      <ul>
        <li>You may be repeatedly asked to authenticate</li>
        <li>Some Git operations may fail</li>
        <li>Collaboration becomes more frustrating than it needs to be</li>
      </ul>
      <p>Once set up, SSH mostly disappears into the background.</p>
      <p>That’s the goal.</p>
    </CollapsibleSection>

      <CollapsibleSection id="not-expected" title="What You're Not Expected to Do Yet" stepCard={true}>
      <h2 id="not-expected">What You’re Not Expected to Do Yet</h2>
      <p>You are not required to:</p>
      <ul>
        <li>Memorize Git commands</li>
        <li>Resolve complex merge conflicts</li>
        <li>Understand every configuration file</li>
      </ul>
      <p>Those skills come with use, not onboarding.</p>
    </CollapsibleSection>

      <CollapsibleSection id="complete-module" title="Complete This Module" stepCard={true} taskIndex={3} moduleId="github-basics">
      <h2 id="complete-module">Complete This Module</h2>
      <p>Once you:</p>
      <ul>
        <li>Understand GitHub’s role</li>
        <li>Know how access works at WEX</li>
        <li>Have a path to authenticate securely</li>
      </ul>
      <p>You’re ready to move on.</p>
      <p>The next module will guide you through running this project locally.</p>
    </CollapsibleSection>

      </div>
    </ModulePageWithTasks>
  </article>
</MatrixModuleLayout>

<script>
  import { markModuleComplete, isModuleComplete, clearModuleComplete } from "../lib/progress";

  const MODULE_ID = "github-basics";
  const btn = document.getElementById("github-mark-complete-btn");
  const completedEl = document.getElementById("github-completed");

  function showConfirmation() {
    if (completedEl) completedEl.hidden = false;
    if (btn) btn.hidden = true;
  }

  function showButtonAgain() {
    if (completedEl) completedEl.hidden = true;
    if (btn) btn.hidden = false;
  }

  if (isModuleComplete(MODULE_ID)) {
    showConfirmation();
  }
  if (btn) {
    btn.addEventListener("click", () => {
      markModuleComplete(MODULE_ID);
      document.dispatchEvent(new CustomEvent("workshop-progress-update"));
      showConfirmation();
    });
  }

  document.addEventListener("workshop-tasks-reset", (e) => {
    const detail = (e as CustomEvent).detail;
    if (detail?.moduleId === MODULE_ID) {
      clearModuleComplete(MODULE_ID);
      document.dispatchEvent(new CustomEvent("workshop-progress-update"));
      showButtonAgain();
    }
  });
</script>
